name: 'Security Audit'
description: 'ğŸ›¡ï¸ Scans dependencies for vulnerabilities and performs static analysis on Python code.'
branding:
  icon: 'shield'
  color: 'purple'
inputs:
  python-version:
    description: 'Python version to use'
    required: false
    default: '3.11'
  target-path:
    description: 'Path to scan with Bandit'
    required: false
    default: '.'
  scan-dependencies:
    description: 'Whether to check dependencies with Safety'
    required: false
    default: 'true'
  scan-code:
    description: 'Whether to perform static analysis with Bandit'
    required: false
    default: 'true'
  bandit-skip:
    description: 'Comma-separated list of Bandit test IDs to skip (e.g., B101,B601)'
    required: false
    default: ''

runs:
  using: 'composite'
  steps:
    - name: ğŸ Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ inputs.python-version }}

    - name: ğŸ”§ Install security tools
      shell: bash
      run: |
        pip install safety bandit

    - name: ğŸ”’ Dependency Check (Safety)
      if: inputs.scan-dependencies == 'true'
      shell: bash
      run: safety check

    - name: ğŸ” Static Analysis (Bandit)
      if: inputs.scan-code == 'true'
      shell: bash
      run: |
        if [ -n "${{ inputs.bandit-skip }}" ]; then
          bandit -r ${{ inputs.target-path }} -s ${{ inputs.bandit-skip }}
        else
          bandit -r ${{ inputs.target-path }}
        fi
